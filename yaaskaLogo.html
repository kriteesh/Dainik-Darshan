<html>
<head>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.5.1/dat.gui.min.js"></script>
	<style>
		html,body {
			width : 100%;
			height : 100%;
			margin : 0;
	
		}
		
		#mirror{
			position : absolute;
			top: 0 ;
			left : 0; 
			height : 100%;
			width : 100%;
			margin : 0 ; 
		}
		#png-download { 
			position: absolute;
			line-height: 5vh;
			height : 5vh;	
			width : 14vw;
			right : 1vw;
			padding : 1vw;
			bottom : 20vh;
			z-index : 2;
			background : #151515;
			cursor : pointer;
			color : white;
			text-decoration:  none;
			text-align: center;
		}
		#png-download:hover{
			opacity : 0.8;
		}
	</style>
</head>
	<body>
		<canvas class="main"></canvas>
		<img src="" id="mirror" onerror="this.style.display='none'"/>
		<a href="#" id="png-download" download="what.png">Take a Snap</a>
	</body>
	<script>
		let canvas = document.querySelector('canvas');
		let w = canvas.width = window.innerWidth;
		let h = canvas.height = window.innerHeight;
		let ctx = canvas.getContext('2d');
		
		let phi = 1.618;
		let scale = 30;
		let coords = new Array(5).fill(1).map((x,i)=>scale*Math.pow(phi,i));
		
		let mirror = document.getElementById('mirror');
		mirror.addEventListener('contextmenu', function (e) {
			let dataURL = canvas.toDataURL('image/png');
			mirror.src = dataURL;
		});

		let png = document.getElementById('png-download');
		png.addEventListener('click', function (e) {
			let dataURL = canvas.toDataURL('image/png');
			guide = false;
			png.href = dataURL;
		});
		
		let outerCircle = (radius) =>color=>{
			ctx.beginPath();
			ctx.fillStyle = color;
			ctx.arc(w/2,h/2,radius,0,2*Math.PI);
			ctx.fill();
		
		}
		
		
		let innerCircle = (radius) =>(lineWidth) =>(color)=>{
			ctx.lineWidth = lineWidth;
			ctx.beginPath();
			ctx.strokeStyle = color;
			ctx.arc(w/2,h/2,radius,0,2*Math.PI);
			ctx.stroke();
			
		}
		
		let rightWhy =(x1,x2,x3)=>(color)=>{
			ctx.fillStyle = color;
			ctx.beginPath();
			ctx.moveTo(x1.x,x1.y);
			ctx.lineTo(x2.x,x2.y);
			ctx.lineTo(x3.x,x3.y);
			ctx.fill();
		}
		
		
		
		let guideSquare = () => {
			ctx.strokeStyle = "grey";
			ctx.lineWidth = 1;
			

			//horizontal lines
			coords.map(x=>{
			ctx.beginPath();
			ctx.moveTo(0,h/2 + x);
			ctx.lineTo(w,h/2 + x);
			ctx.stroke();
			}
			)
			coords.map(x=>{
			ctx.beginPath();
			ctx.moveTo(0,h/2 - x);
			ctx.lineTo(w,h/2 - x);
			ctx.stroke();
			}
			)
			//vertical lines
			coords.map(x=>{
			ctx.beginPath();
			ctx.moveTo(w/2 + x,0);
			ctx.lineTo(w/2 + x,h);
			ctx.stroke();
			}
			)
			coords.map(x=>{
			ctx.beginPath();
			ctx.moveTo(w/2 - x,0);
			ctx.lineTo(w/2 - x,h);
			ctx.stroke();
			}
			)
		}
		
	   let  controls = new function() {
            this.outRadius = 291;
            this.inRadius = this.outRadius*0.9;
		   	this.lineWidth = 15; 
		    this.trx1 = {x : w/2 + coords[3] , y : h/2 - coords[3]};
		   	this.trx2 = {x : w/2 + coords[0], y : h/2+coords[3]};
		   	this.trx3 = {x : w/2 - coords[3], y : h/2 + coords[3]};
		    
		   	this.tlx1 = {x : w/2 - coords[3], y : h/2 - coords[3]};
		   	this.tlx2 = {x : w/2  + coords[0], y : h/2 - coords[1]};
		   	this.tlx3 = {x : w/2  - coords[1] , y : h/2 + coords[0]};
		   
		   	this.foreground = '#151515';
		    this.background = '#00ffff';
		    this.guide = true;
        }
		
			
	  	let gui = new dat.GUI();
		gui.add(controls, 'outRadius',100,500);
        gui.add(controls, 'inRadius',10,300);
		gui.add(controls, 'lineWidth',1,40);
		gui.addColor(controls,'foreground');
		gui.addColor(controls,'background');
		gui.add(controls,'guide');
		
		let triangleRight = gui.addFolder('triangleRight');
		triangleRight.add(controls.trx1, 'x',w/2-200,w/2 + 200 );
		triangleRight.add(controls.trx1, 'y',h/2-200,h/2+200);
		triangleRight.add(controls.trx2, 'x',w/2 - 200,w/2 + 200);
		triangleRight.add(controls.trx2, 'y',h/2-200,h/2+200);
		triangleRight.add(controls.trx3, 'x',w/2 - 200,w/2 + 200);
		triangleRight.add(controls.trx3, 'y',h/2-200,h/2-200);
		
		let triangleLeft = gui.addFolder('triangleLeft');
		triangleLeft.add(controls.tlx1, 'x',w/2-200,w/2 + 200 );
		triangleLeft.add(controls.tlx1, 'y',h/2-200,h/2+200);
		triangleLeft.add(controls.tlx2, 'x',w/2 - 200,w/2 + 200);
		triangleLeft.add(controls.tlx2, 'y',h/2-200,h/2+200);
		triangleLeft.add(controls.tlx3, 'x',w/2 - 200,w/2 + 200);
		triangleLeft.add(controls.tlx3, 'y',h/2+200,h/2-200);

		
		let guide = true;
		
		let animate = () =>{
			requestAnimationFrame(animate);
			ctx.clearRect(0,0,w,h);
			outerCircle(controls.outRadius)(controls.background);
			innerCircle(controls.inRadius)(controls.lineWidth)(controls.foreground);
			rightWhy(controls.trx1,controls.trx2,controls.trx3)(controls.foreground);
			rightWhy(controls.tlx1,controls.tlx2,controls.tlx3)(controls.foreground);
			if(controls.guide) guideSquare();
			
		}
		animate();
	
		
			
	</script>
</html>